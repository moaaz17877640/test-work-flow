{"version":3,"file":"0.js","sources":["webpack:///./pages/board/mark-editor.js"],"sourcesContent":["import React, { Component } from 'react';\nimport SimpleMDEEditor from 'yt-simplemde-editor';\nimport marked from 'marked';\nimport { Button, Input, Alert, notification } from 'antd';\nimport hljs from 'highlight.js';\nimport moment from 'moment'\nimport axios from 'axios';\nimport { BoardPublishRequest } from '../../config/request'\nmoment.locale('zh-cn');\n\nhljs.configure({\n  tabReplace: '  ',\n  classPrefix: 'hljs-',\n  languages: ['CSS', 'HTML, XML', 'JavaScript', 'PHP', 'Python', 'Stylus', 'TypeScript', 'Markdown']\n})\n\nmarked.setOptions({\n  highlight: (code) => hljs.highlightAuto(code).value,\n  gfm: true,\n  tables: true,\n  breaks: false,\n  pedantic: false,\n  sanitize: true,\n  smartLists: true,\n  smartypants: false\n});\n\nclass MdEditor extends Component {\n  state = {\n    value: '',\n    isWarning: false,\n    warnMsg:'留言信息不完整'\n  };\n\n  renderMarkdown = text => marked(text, { breaks: true });\n\n  async handleSubmit(){\n\n    const {value, userName} = this.state;\n\n    if(!value.replace(/^\\s+|\\s+$/g,\"\") || !userName.replace(/^\\s+|\\s+$/g,\"\")){\n\n      this.setState({\n        isWarning: true,\n        warnMsg:'留言信息不完整'\n      })\n\n    }else{\n\n      this.setState({\n        isWarning: false\n      });\n\n      const data = {\n        date: moment().format(\"YYYY-DD-MM HH:mm:ss\"),\n        value: this.state.value,\n        username: this.state.userName\n      }\n      \n      const res = await axios.post(BoardPublishRequest, data);\n      if(res.data.code){\n        notification['success']({\n          message: '留言成功^~^',\n          description: '放心吧，作者看到会回复你的',\n        });\n        this.setState({\n          value: '',\n          userName: ''\n        });\n        location.reload();\n      }else{\n        this.setState({\n          isWarning: true,\n          warnMsg: res.data.msg\n        })\n      }\n\n    }\n  }\n\n  emitEmpty = () => {\n    this.setState({ userName: '' });\n  }\n\n  onChangeUserName = (e) => {\n    this.setState({ userName: e.target.value });\n  }\n\n  render () {\n\n    const editorProps = {\n      value: this.state.value,\n      getMdeInstance: simplemde => {\n        this.simplemde = simplemde;\n      },\n      onChange: value => {\n        this.setState({ value })\n      },\n      options: {\n        autofocus:false,\n        spellChecker: false,\n        forceSync: true,\n        previewRender: this.renderMarkdown,\n        tabSize: 4,\n        placeholder:'写点什么吧',\n        toolbar: [\n          'code',\n          'link',\n          'image',\n          'preview'\n        ],\n        status:false\n      }\n    };\n\n    const { userName, isWarning, warnMsg } = this.state;\n\n    return (\n      <div>\n        <img src=\"/static/commet-avator.png\" className='board-p-avator'/>\n        <Input\n          placeholder=\"写下你的名字吧\"\n          value={userName}\n          onChange={this.onChangeUserName}\n          ref={node => this.userNameInput = node}\n          className='board-name'\n        />\n        <SimpleMDEEditor {...editorProps} />\n        <Alert message={warnMsg} type=\"warning\" className={isWarning ? 'board-warning' : ''}/>\n        <Button type='primary' className='f-r' onClick={()=>this.handleSubmit()}>留个言吧</Button>\n        \n        <style global jsx>{`\n        button{\n          margin-top: 10px;\n        }\n\t\t\t\t`}</style>\n      </div>\n    )\n  }\n}\n\nexport default MdEditor"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AA+CA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAlDA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AA1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoDA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAGA;;;;A","sourceRoot":""}